{% extends 'layouts/bulma-ufs.layout.njk' %}

{#{% set navType = 'admin' %}#}
{% set firstNameError = firstNameError if firstNameError %}
{% set lastNameError = lastNameError if lastNameError %}
{% set emailNameError = emailNameError if emailNameError %}
{% set passwordError = passwordError if passwordError %}
{% set isDetailsError = isDetailsError if isDetailsError %}
{#{% set isAdminUser = true %}#}
{% set firstName = firstName if firstName %}
{% set lastName = lastName if lastName %}
{% set emailAddress = emailAddress if emailAddress %}

{%  set loggedOut = true %}

{% set pageTitle = 'Enter your details' + GLOBAL_TAG_TITLE_SUFFIX %}

{% block content %}

    {% call components.bulmaRow() %}
        {% call components.bulmaColumnAny(size='is-two-thirds') %}
            {{ components.backLink(text='Back to Opportunity page', url='/prototypes/register-v1/organisation') }}
        {%- endcall %}
    {%- endcall %}

    {% if isDetailsError %}

        {% call components.bulmaRow() %}

            {% call components.bulmaColumnAny(size='is-full') %}

                <div class="govuk-error-summary" aria-labelledby="error-summary-title" role="alert" tabindex="-1" data-module="govuk-error-summary">
                    <h2 class="govuk-error-summary__title" id="error-summary-title">There is a problem</h2>
                    <div class="govuk-error-summary__body">
                        <ul class="govuk-list govuk-error-summary__list">
                            {% if firstNameError %}
                            <li><a href="#firstName">First name not entered</a></li>
                            {% endif %}
                            {% if lastNameError %}
                                <li><a href="#lastName">Last name not entered</a></li>
                            {% endif %}
                            {% if emailError %}
                                <li><a href="#email">Invalid email format</a></li>
                            {% endif %}
                            {% if passwordError %}
                                <li><a href="#password">Valid password not entered</a></li>
                            {% endif %}
                        </ul>
                    </div>
                </div>

            {%- endcall %}

        {%- endcall %}

    {% endif %}

    {% call components.bulmaRow() %}
        {% call components.bulmaColumnAny(size='is-two-thirds') %}
            {{ components.captionHeading(text='Enter your details',  caption='Apply to OPP123: Microbiotics in freshwater environments') }}
        {%- endcall %}
    {%- endcall %}

    {% call components.form(action='/prototypes/register-v1/details', method='POST', name='details') %}

        {% call components.bulmaRow() %}

            {% call components.bulmaColumnAny(size='column column is-full is-9-desktop is-9-widescreen', customID='main-content') %}

                <div class="govuk-form-group {% if firstNameError %}govuk-form-group--error{% endif %}">
                    <label class="govuk-label govuk-label--s" for="firstName" id="firstNameLabel">First name
                        {% if firstNameError %}
                            <span class="govuk-error-message">
                                <span class="govuk-visually-hidden">Error:</span> You must enter a first name
                            </span>
                        {% endif %}
                    </label>
                    <input class="govuk-input govuk-input--width-30 {% if firstNameError %}govuk-input--error{% endif %}" id="firstName" type="text" name="firstName" value="{{ firstName }}">
                </div>

            {%- endcall %}

        {%- endcall %}

        {% call components.bulmaRow() %}

            {% call components.bulmaColumnAny(size='column column is-full is-9-desktop is-9-widescreen') %}

                <div class="govuk-form-group {% if lastNameError %}govuk-form-group--error{% endif %}">
                    <label class="govuk-label govuk-label--s" for="lastName" id="lastNameLabel">Last name
                        {% if lastNameError %}
                            <span class="govuk-error-message">
                                <span class="govuk-visually-hidden">Error:</span> You must enter a last name
                            </span>
                        {% endif %}
                    </label>
                    <input class="govuk-input govuk-input--width-30 {% if lastNameError %}govuk-input--error{% endif %}" id="lastName" type="text" name="lastName" value="{{ lastName }}">
                </div>

            {%- endcall %}

        {%- endcall %}

        {% call components.bulmaRow() %}

            {% call components.bulmaColumnAny(size='column column is-full is-9-desktop is-9-widescreen') %}

                <div class="govuk-form-group {% if emailError %}govuk-form-group--error{% endif %}">
                    <label class="govuk-label govuk-label--s" for="emailAddress" id="emailLabel">Email address
                        {% if emailError %}
                            <span class="govuk-error-message">
                                <span class="govuk-visually-hidden">Error:</span>You must enter a valid email address                                                         </span>
                        {% endif %}
                    </label>
                    <input class="govuk-input govuk-input--width-30 {% if emailError %}govuk-input--error{% endif %}" id="emailAddress" type="text" name="emailAddress" value="{{ emailAddress }}">
                </div>

            {%- endcall %}

        {%- endcall %}

      {#  {% call components.bulmaRow() %}

            {% call components.bulmaColumnAny(size='column column is-full is-9-desktop is-9-widescreen', customID='main-content') %}

                <div class="create-password">
                    <h2 class="govuk-heading-s">Create password</h2>

                    <p class="govuk-body">Your password is case-sensitive, can include spaces to make a phrase and must:</p>

                    <ul class="govuk-list govuk-list--bullet">
                        <li>be at least 8 characters long </li>
                        <li>not be commonly used</li>
                    </ul>

                    <div class="govuk-form-group password-toggle ">
                        <label class="govuk-label govuk-label--s" for="password" id="passwordLabel"><span class="govuk-visually-hidden">Password</span>
                            {% if passwordError %}
                                <span class="govuk-error-message">
                                    <span class="govuk-visually-hidden">Error:</span> Enter a valid password
                                </span>
                            {% endif %}
                        </label>
                        <input class="govuk-input govuk-input--width-20" id="password" type="password" name="password" value=""><a href="#" class="password-toggle__link password-shown">Show <span class="govuk-visually-hidden">password</span></a>
                    </div>
                </div>

            {%- endcall %}

        {%- endcall %}#}

        {% call components.bulmaRow() %}

            {% call components.bulmaColumnAny(size='column column is-full is-9-desktop is-9-widescreen') %}

                <div class="create-password {#create-password--error#} {% if passwordError %}create-password--error{% endif %}">
                    <h2 class="govuk-heading-s">Create password</h2>

                    <p class="govuk-body">Your password is case-sensitive, can include spaces to make a phrase and must:</p>

                    <ul class="govuk-list govuk-list--bullet create-password__criteria-list">
                        {% if passwordError %}
                        <li class="create-password__criteria-item create-password__criteria-item--success">have at least 8 characters</li>
                        <li class="create-password__criteria-item create-password__criteria-item--error">not be commonly used</li>
                        {% else %}
                            <li class="create-password__criteria-item">have at least 8 characters</li>
                            <li class="create-password__criteria-item">not be commonly used</li>
                        {% endif %}
                    </ul>

                    <div class="govuk-form-group password-toggle">
                        <label class="govuk-label govuk-label--s" for="password" id="passwordLabel"><span class="govuk-visually-hidden">Password</span>
                            {% if passwordError %}
                                <span class="govuk-error-message">
                                    <span class="govuk-visually-hidden">Error:</span> You must enter a valid password
                                </span>
                            {% endif %}
                        </label>
                        <input class="govuk-input govuk-input--width-30 {% if passwordError %}govuk-input--error{% endif %}" id="password" type="password" name="password" value=""><a href="#" class="password-toggle__link password-shown">Show <span class="govuk-visually-hidden">password</span></a>
                    </div>
                </div>

            {%- endcall %}

        {%- endcall %}



        {% call components.bulmaRow() %}

            {% call components.bulmaColumnAny(size='column column is-full is-9-desktop is-9-widescreen') %}

                {#<p class="govuk-body">UKRI abide by... using my personal data in accordance with current <a href="#" class="govuk-link">UK data protection legislation</a>.</p>#}

                {#<p class="govuk-body">You will need your email address and password each time you sign in. We will only use your email to send you security updates or if you need to recover your details.</p>#}

                {#<p class="govuk-body">We will now email you a link to confirm it is your email address so we can create your account.</p>#}

                {% call components.formGroup() %}
                    {{ components.button(text='Continue', extraClass="application-controls__submit")}}
                {%- endcall %}

            {%- endcall %}

        {%- endcall %}

    {%- endcall %} {# end form #}
    {% include '../../layouts/partials/user-contact.njk' %}
{% endblock %}
{% block bodyScripts %}
    <script>
      // TODO: Rewrite this entirely as it's hideous, but it works.
      // ALL js-dependent elements should be added to the DOM via a single identifier
      // Really, we should have a second "password confirm" input when there is no JS
      let shown = 'password-shown';
      let hidden = 'password-hidden';
      let hiddenText = 'Show <span class="govuk-visually-hidden">password</span>';
      let shownText = 'Hide <span class="govuk-visually-hidden">password</span>';
      let passwordField = document.getElementById('password');
      let passwordToggleSwitch = document.getElementsByClassName('password-toggle__link');

      // document.getElementById('passwordToggler').onclick = function() {
      passwordToggleSwitch[0].onclick = function (e) {
        e.preventDefault();
        if(this.classList.contains(shown) ) {
          passwordField.type="text";
          this.classList.remove(shown);
          this.className += ' '+hidden;
          this.innerHTML = shownText;
        } else if(this.classList.contains(hidden) ) {
          passwordField.type="password";
          this.classList.remove(hidden);
          this.className += ' '+shown;
          this.innerHTML = hiddenText;
        }
      }
    </script>
{% endblock %}


